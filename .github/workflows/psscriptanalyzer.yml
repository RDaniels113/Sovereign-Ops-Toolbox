name: psscriptanalyzer
on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  analyze:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v5
      - name: Install PSScriptAnalyzer
        shell: pwsh
        run: Install-Module PSScriptAnalyzer -Scope CurrentUser -Force
      - name: Run PSScriptAnalyzer
        shell: pwsh
        run: |
          $ErrorActionPreference = 'Continue'
          $results = Invoke-ScriptAnalyzer -Path ./powershell -Recurse -Severity Error,Warning
          if ($results) {
            $results | Format-Table
            Write-Error "PSScriptAnalyzer found issues."
          } else {
            Write-Host "PSScriptAnalyzer clean."
          }
